const jokes = [
  "1945 год. Штирлиц и Мюллер издалека наблюдают как немецкие войска отступают под натиском советском армии. 'Наши приближаются — Подумали оба.'",
  "Деревенский кузнец сказал новому подмастерью: - Сейчас выну из огня подкову. Как кивну головой, со всей силы бей по ней молотом. Так новичок-подмастерье сразу стал кузнецом.",
  "Как зовут кота-программиста? — Код.",
  "Шёл медведь по космосу, видит — плотные слои атмосферы, вошёл в них и сгорел.",
  "Почему студенты не боятся темноты? — Потому что в темноте не видно зачётки.",
  "Немецкие ученые открыли пиво",
  "Санкт-Петербург. При прокладке новой линии метрополитена на глубине 70 метров метростроевцы обнаружили здание старого Эрмитажа. Каково же было их удивление, когда они поднялись на поверхность и не обнаружили здания нового Эрмитажа",
  "Всемирно известный квартет ищет двух скрипачей и виолончелиста",
  "- Buongiorno! - Ciao Elon Musk. 'Римское приветствие', - догадался Штирлиц.",
  "Азартный учитель географии проиграл своего сына в города",
  "Идут по Питеру три инвалида — один слепой, другой безрукий, третий тоже на бюджет поступит.",
  "Что бы малому бизнесу в России было приятнее, государство его немножко придушивает",  
  "Пожалуй, одна из самых противоречивых вещей в этом мире – это кляп во рту.",
  "- Ваша честь, если ты это то что ты ешь, то мой клиент - невинный человек",
  "Мальчик, лизнувший саксофон на морозе, полтора часа бесплатно наслаждался джазовой импровизацией",
  "В узком проливе сходятся русский и американский авианосцы. На носу русского стоит матрос и орёт : - ПОВОРАААЧИВАААЙ! С американского судна раздаются крики матросов : - We dont understand! - ДУ Ю СПИК ИНГЛИШ?! - Yes! Yes! - ДАЙ МАНКИ",
  "Oднaжды oдин чeлoвeк вcтpeтил джинa, и тoт cкaзaл eмy: - Я иcпoлню любыe твoи жeлaния, нo чтo бы ты нe зaгaдaл, - твoй coceд, кoтopoгo ты нeнaвидишь, пoлyчит вдвoe бoльшe. Сосед схлопнулся из-за переполнения стека",
  "Начальник тюрьмы обращается к смертнику, сидящему на электрическом стуле: — Ваше последнее желание? — Пожалуйста держите меня за руку. Мне так спокойнее будет",
  "Как разговаривают Циклопы? С глазу на глаз",
  "Говорящая капуста говорит остальным говорящим овощам: 'Если начнется пожар - не смейте меня тушить'",
  "Молдавское колесо обозрения за один оборот делает 3 замеса бетона",
  "Штирлиц бросился на выручку, но кассиры его отогнали",
  "Что ожидает карлика играющего на фондовой бирже?  Низкий рост.",
  "Когда мне сказали, что у меня биполярное расстройство, я не знал плакать мне или смеяться.",
  "Шёл медведь по лесу, видит машина горит, обошёл её, упал в речку и утонул.",
  "В бюджетной школе уроки проходят даром",

];

const input = document.getElementById('topic');
const button = document.getElementById('find');
const result = document.getElementById('result');


function highlightMatch(text, query) {
  if (!query) return text;
  const regex = new RegExp(`(${escapeRegExp(query)})`, 'gi');
  return text.replace(regex, '<span class="highlight">$1</span>');
}


function escapeRegExp(string) {
  return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

function showJoke(text, query) {
  result.classList.remove('visible');
  setTimeout(() => {
    result.innerHTML = highlightMatch(text, query);
    result.classList.add('visible');
  }, 300);
}

button.addEventListener('click', () => {
  const query = input.value.trim().toLowerCase();

  if (!query) {
    showJoke("Пожалуйста, введите тему для поиска!");
    return;
  }

if (query === 'любой') {
  const random = jokes[Math.floor(Math.random() * jokes.length)];
  showJoke(random, '');
  return;
}

const filtered = jokes.filter(joke => joke.toLowerCase().includes(query));

if (filtered.length > 0) {
  const randomJoke = filtered[Math.floor(Math.random() * filtered.length)];
  showJoke(randomJoke, query);
} else {
  const random = jokes[Math.floor(Math.random() * jokes.length)];
  showJoke(`Анекдот по теме не найден, но вот вам классика: Купил мужик шляпу, а она ему как раз!`, '');
}
});
